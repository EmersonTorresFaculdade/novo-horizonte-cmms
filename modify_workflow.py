
import json

path = r'C:\Users\Emerson\.gemini\antigravity\brain\4498883e-87f9-478b-bea2-b9907dd7f6f7\.system_generated\steps\4732\output.txt'
with open(path, 'r', encoding='utf-8') as f:
    data = json.load(f)

# Extract the nodes from the data object
nodes = data['data']['nodes']

for node in nodes:
    # 1. Admin WhatsApp
    if node['name'] == 'Admin WhatsApp':
        for param in node['parameters']['bodyParameters']['parameters']:
            if param['name'] == 'text':
                param['value'] = "={{ `üîî *Novo Horizonte CMMS*\nüìù *${$json.body.subject_display} #${$json.body.workOrder.order_number || $json.body.workOrder.osNumber || 'N/A'}*\n\nOl√°, Administrador Root!\nSua ordem de servi√ßo ${$json.body.intro_display}. üëá\n\nüè≠ *M√°quina:* ${$json.body.workOrder.assetName || 'N/A'}\nüìÇ *Falha:* ${$json.body.failure_type || 'N/A'}\nüõ†Ô∏è *Classe:* ${$json.body.workOrder.maintenance_type || 'N/A'}\nüìÑ *Descri√ß√£o:* ${$json.body.workOrder.description || 'N/A'}\nüö¶ *Status:* ${$json.body.workOrder.status || 'N/A'}\nüë®‚Äçüîß *T√©cnico:* ${$json.body.workOrder.technicianName && $json.body.workOrder.technicianName !== 'Pendente' && $json.body.workOrder.technicianName !== 'Aguardando' ? $json.body.workOrder.technicianName : 'N√£o atribu√≠do'}${ $json.body.technical_report ? '\\nüõ†Ô∏è *Relat√≥rio T√©cnico:*\\n' + $json.body.technical_report : '' }\n\nüîó *Acompanhe aqui:* ${$json.body.workOrder.url || ('https://manutencao.novohorizonte.com/#/work-orders/' + $json.body.workOrder.id)}` }}"

    # 2. Requester WhatsApp
    if node['name'] == 'Requester WhatsApp':
        for param in node['parameters']['bodyParameters']['parameters']:
            if param['name'] == 'text':
                param['value'] = "={{ `üîî *Novo Horizonte CMMS*\nüìù *${$json.body.subject_display} #${$json.body.workOrder.order_number || $json.body.workOrder.osNumber || 'N/A'}*\n\nOl√°, ${$json.body.requesterName || 'Solicitante'}!\nSua ordem de servi√ßo ${$json.body.intro_display}. üëá\n\nüè≠ *M√°quina:* ${$json.body.workOrder.assetName || 'N/A'}\nüìÇ *Falha:* ${$json.body.failure_type || 'N/A'}\nüõ†Ô∏è *Classe:* ${$json.body.workOrder.maintenance_type || 'N/A'}\nüìÑ *Descri√ß√£o:* ${$json.body.workOrder.description || 'N/A'}\nüö¶ *Status:* ${$json.body.workOrder.status || 'N/A'}\nüë®‚Äçüîß *T√©cnico:* ${$json.body.workOrder.technicianName && $json.body.workOrder.technicianName !== 'Pendente' && $json.body.workOrder.technicianName !== 'Aguardando' ? $json.body.workOrder.technicianName : 'N√£o atribu√≠do'}${ $json.body.technical_report ? '\\nüõ†Ô∏è *Relat√≥rio T√©cnico:*\\n' + $json.body.technical_report : '' }\n\nüîó *Acompanhe aqui:* ${$json.body.workOrder.url || ('https://manutencao.novohorizonte.com/#/work-orders/' + $json.body.workOrder.id)}` }}"

    # 3. Admin Email
    if node['name'] == 'Admin Email':
        node['parameters']['subject'] = "={{ $json.body.subject_display + ' #' + ($json.body.workOrder.order_number || $json.body.workOrder.osNumber || 'N/A') }}"
        node['parameters']['html'] = "={{ `<!DOCTYPE html><html><head><meta charset=\"UTF-8\"><title>Notifica√ß√£o CMMS</title><style>body{margin:0;padding:0;background:#F4F6F8;font-family:Arial,Helvetica,sans-serif;}.container{max-width:640px;margin:40px auto;background:#ffffff;border-radius:12px;overflow:hidden;box-shadow:0 12px 35px rgba(0,0,0,0.08);}.header{background:#1C1F24;color:#ffffff;padding:30px;text-align:center;}.header h1{margin:0;font-size:20px;font-weight:600;}.header span{color:#1F7A4C;}.content{padding:30px;}.intro{font-size:15px;color:#444;margin-bottom:25px;}.card{background:#F9FBFC;border-left:5px solid #1F7A4C;padding:22px;border-radius:8px;}.field{margin-bottom:18px;}.label{font-size:12px;text-transform:uppercase;color:#8a8f98;margin-bottom:5px;font-weight:600;}.value{font-size:15px;font-weight:600;color:#1C1F24;}.badge{background:#E6F4EC;color:#1F7A4C;padding:6px 14px;border-radius:20px;font-size:12px;font-weight:600;display:inline-block;}.priority{color:#D84315;}.button-container{text-align:center;margin-top:30px;}.button{display:inline-block;padding:14px 28px;background:#1F7A4C;color:#ffffff;text-decoration:none;border-radius:8px;font-size:15px;font-weight:600;}.footer{background:#1C1F24;color:#b5bcc6;padding:18px;text-align:center;font-size:12px;}</style></head><body><div class=\"container\"><div class=\"header\"><h1>${$json.body.subject_display} <span>#${$json.body.workOrder.order_number || $json.body.workOrder.osNumber || 'N/A'}</span></h1></div><div class=\"content\"><p class=\"intro\">Ol√° <strong>Administrador</strong>, sua ordem de servi√ßo ${$json.body.intro_display}. Veja os detalhes abaixo:</p><div class=\"card\"><div class=\"field\"><div class=\"label\">T√≠tulo / Descri√ß√£o</div><div class=\"value\">${$json.body.workOrder.title || $json.body.workOrder.description || 'N√£o informado'}</div></div><div class=\"field\"><div class=\"label\">M√°quina / Ativo</div><div class=\"value\">${$json.body.workOrder.assetName ? $json.body.workOrder.assetName : 'N√£o informado'}</div></div><div class=\"field\"><div class=\"label\">Tipo de Falha</div><div class=\"value\">${$json.body.failure_type || 'N√£o especificado'}</div></div><div class=\"field\"><div class=\"label\">Classe de Manuten√ß√£o</div><div class=\"value\">${$json.body.workOrder.maintenance_type || 'N√£o especificada'}</div></div><div class=\"field\"><div class=\"label\">Status</div><div class=\"value\"><span class=\"badge\">${$json.body.workOrder.status || 'N/A'}</span></div></div><div class=\"field\"><div class=\"label\">Prioridade</div><div class=\"value priority\">${$json.body.workOrder.priority || 'N/A'}</div></div><div class=\"field\"><div class=\"label\">T√©cnico Respons√°vel</div><div class=\"value\">${$json.body.workOrder.technicianName && $json.body.workOrder.technicianName !== 'Pendente' && $json.body.workOrder.technicianName !== 'Aguardando' ? $json.body.workOrder.technicianName : 'N√£o atribu√≠do'}</div></div><div class=\"field\"><div class=\"label\">Solicitante</div><div class=\"value\">${$json.body.requesterName || $json.body.requesterEmail || 'N√£o informado'}</div></div>${ $json.body.technical_report ? `<div class=\"field\"><div class=\"label\">Relat√≥rio T√©cnico</div><div class=\"value\" style=\"white-space:pre-wrap;background:#f8f9fa;padding:10px;border:1px solid #eee\">${$json.body.technical_report}</div></div>` : '' }</div><div class=\"button-container\"><a href=\"${$json.body.workOrder.url || ('https://manutencao.novohorizonte.com/#/work-orders/' + $json.body.workOrder.id)}\" class=\"button\">Acessar Ordem de Servi√ßo</a></div></div><div class=\"footer\">Novo Horizonte CMMS ‚Ä¢ Gest√£o de Manuten√ß√£o<br>¬© 2026 Novo Horizonte</div></div></body></html>` }}"

    # 4. Send Requester Email
    if node['name'] == 'Send Requester Email':
        node['parameters']['subject'] = "={{ $json.body.subject_display + ' #' + ($json.body.workOrder.order_number || $json.body.workOrder.osNumber || 'N/A') }}"
        node['parameters']['html'] = "={{ `<!DOCTYPE html><html><head><meta charset=\"UTF-8\"><title>Notifica√ß√£o CMMS</title><style>body{margin:0;padding:0;background:#F4F6F8;font-family:Arial,Helvetica,sans-serif;}.container{max-width:640px;margin:40px auto;background:#ffffff;border-radius:12px;overflow:hidden;box-shadow:0 12px 35px rgba(0,0,0,0.08);}.header{background:#1C1F24;color:#ffffff;padding:30px;text-align:center;}.header h1{margin:0;font-size:20px;font-weight:600;}.header span{color:#1F7A4C;}.content{padding:30px;}.intro{font-size:15px;color:#444;margin-bottom:25px;}.card{background:#F9FBFC;border-left:5px solid #1F7A4C;padding:22px;border-radius:8px;}.field{margin-bottom:18px;}.label{font-size:12px;text-transform:uppercase;color:#8a8f98;margin-bottom:5px;font-weight:600;}.value{font-size:15px;font-weight:600;color:#1C1F24;}.badge{background:#E6F4EC;color:#1F7A4C;padding:6px 14px;border-radius:20px;font-size:12px;font-weight:600;display:inline-block;}.priority{color:#D84315;}.button-container{text-align:center;margin-top:30px;}.button{display:inline-block;padding:14px 28px;background:#1F7A4C;color:#ffffff;text-decoration:none;border-radius:8px;font-size:15px;font-weight:600;}.footer{background:#1C1F24;color:#b5bcc6;padding:18px;text-align:center;font-size:12px;}</style></head><body><div class=\"container\"><div class=\"header\"><h1>${$json.body.subject_display} <span>#${$json.body.workOrder.order_number || $json.body.workOrder.osNumber || 'N/A'}</span></h1></div><div class=\"content\"><p class=\"intro\">Ol√° <strong>${$json.body.requesterName || 'Solicitante'}</strong>, sua ordem de servi√ßo ${$json.body.intro_display} no sistema CMMS. Veja os detalhes abaixo:</p><div class=\"card\"><div class=\"field\"><div class=\"label\">T√≠tulo / Descri√ß√£o</div><div class=\"value\">${$json.body.workOrder.title || $json.body.workOrder.description || 'N√£o informado'}</div></div><div class=\"field\"><div class=\"label\">M√°quina / Ativo</div><div class=\"value\">${$json.body.workOrder.assetName ? $json.body.workOrder.assetName : 'N√£o informado'}</div></div><div class=\"field\"><div class=\"label\">Tipo de Falha</div><div class=\"value\">${$json.body.failure_type || 'N√£o especificado'}</div></div><div class=\"field\"><div class=\"label\">Classe de Manuten√ß√£o</div><div class=\"value\">${$json.body.workOrder.maintenance_type || 'N√£o especificada'}</div></div><div class=\"field\"><div class=\"label\">Novo Status</div><div class=\"value\"><span class=\"badge\">${$json.body.workOrder.status || 'N/A'}</span></div></div><div class=\"field\"><div class=\"label\">Prioridade</div><div class=\"value priority\">${$json.body.workOrder.priority || 'N/A'}</div></div><div class=\"field\"><div class=\"label\">T√©cnico Respons√°vel</div><div class=\"value\">${$json.body.workOrder.technicianName && $json.body.workOrder.technicianName !== 'Pendente' && $json.body.workOrder.technicianName !== 'Aguardando' ? $json.body.workOrder.technicianName : 'N√£o atribu√≠do'}</div></div>${ $json.body.technical_report ? `<div class=\"field\"><div class=\"label\">Relat√≥rio T√©cnico</div><div class=\"value\" style=\"white-space:pre-wrap;background:#f8f9fa;padding:10px;border:1px solid #eee\">${$json.body.technical_report}</div></div>` : '' }</div><div class=\"button-container\"><a href=\"${$json.body.workOrder.url || ('https://manutencao.novohorizonte.com/#/work-orders/' + $json.body.workOrder.id)}\" class=\"button\">Ver Detalhes da OS</a></div></div><div class=\"footer\">Novo Horizonte CMMS ‚Ä¢ Fique por dentro!<br>¬© 2026 Novo Horizonte</div></div></body></html>` }}"

    # 5. Condition: Check Requester Eligibility
    if node['name'] == 'Check Requester Eligibility':
        for cond in node['parameters']['conditions']['conditions']:
            if cond['id'] == 'cond-req-wa-event-1':
                cond['rightValue'] = "/work_order_created|work_order_updated|work_order_reopened|work_order_cancelled/"

    # 6. Condition: Check Requester Email
    if node['name'] == 'Check Requester Email':
        for cond in node['parameters']['conditions']['conditions']:
            if cond['id'] == 'cond-req-em-event-1':
                cond['rightValue'] = "/work_order_created|work_order_updated|work_order_reopened|work_order_cancelled/"

with open('updated_workflow.json', 'w', encoding='utf-8') as f:
    json.dump({'nodes': nodes, 'connections': data['data']['connections'], 'name': data['data']['name'], 'settings': data['data']['settings']}, f, indent=2)
